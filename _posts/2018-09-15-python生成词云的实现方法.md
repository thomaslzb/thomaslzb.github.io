---
layout:     post
title:      Python ç”Ÿæˆè¯äº‘çš„å®ç°æ–¹æ³•
subtitle:   Python generation word cloud ğŸ˜…
date:       2017-09-15
author:     LZB
header-img: img/post-bg-python.jpg
catalog: true
tags:
    - Python
---


Pythonç”Ÿæˆè¯äº‘çš„å®ç°æ–¹æ³•

## å•å­—è¯äº‘ ##


    import numpy as np
    import matplotlib.pyplot as plt
    from wordcloud import WordCloud
    
    text = "Good"
    
    x, y = np.ogrid[0:300, 0:300]
    
    mask = (x - 150) ** 2 + (y - 150) ** 2 > 130 ** 2
    mask = 255 * mask.astype(int)
    
    
    wc = WordCloud(background_color="white", repeat=True, mask=mask)
    wc.generate(text)
    
    plt.axis("off")
    plt.imshow(wc, interpolation="bilinear")
    plt.show()

æ˜¾ç¤ºå•å­—è¯äº‘çš„å›¾åƒ

[](http://thomaslzb.github.io/post_img/Simple_Word.png)

## ç”Ÿæˆå¤´åƒè¯äº‘ ##
ä¸‹é¢æˆ‘ä»¬ä¸€é²è¿…çš„å¤´åƒï¼Œç”¨ä»–çš„ä¸€ç¯‡æ–‡ç« â€œå‘å–Šâ€ï¼Œ è¦ç”Ÿæˆçš„æ˜¯é²è¿…å¤´åƒçš„è¯äº‘ã€‚

æ‰€è¦ç”¨åˆ°çš„pythonåº“æœ‰
    
	import jieba
	import jieba.analyse
	from os import path
	from scipy.misc import imread
	import matplotlib.pyplot as plt
	import os
	from wordcloud import WordCloud, ImageColorGenerator

    
é¦–å…ˆæˆ‘ä»¬è¦åšçš„æ˜¯è¯»å–æ­Œè¯ã€‚æˆ‘å°†æ­Œè¯å­˜åœ¨äº†æ–‡ä»¶ç›®å½•ä¸‹åŠ±å¿—æ­Œæ›²æ–‡æœ¬ä¸­ã€‚

ç°åœ¨æ¥è¯»å–ä»–

```
# get data directory (using getcwd() is needed to support running example in generated IPython notebook)
d = path.dirname(__file__) if "__file__" in locals() else os.getcwd()

stopwords_path = d + '/files/stopwords.txt'

# Chinese fonts must be set è¿™ä¸ªå­—åº“å¿…é¡»è¦
font_path = d + '/files/fonts/SourceHanSerifK-Light.otf'

# the path to save worldcloud
imgname1 = d + '/files/LuXun.jpg'
imgname2 = d + '/files/LuXun_colored.jpg'

#files is exist?
if not (os.path.isfile(stopwords_path) and os.path.isfile(font_path) and \
        os.path.isfile(imgname1) ) :
    if not os.path.isfile(stopwords_path):
        print ("stopwords_path or pngFile does not found!")
    if not os.path.isfile(font_path):
        print ("font_path or pngFile does not found!")
    if not os.path.isfile(imgname1):
        print ("imgname1 or pngFile does not found!")
    os._exit(0)

# read the mask / color image taken from
back_coloring = imread(path.join(d, d + '/files/luxun_color.jpg'))
txt_book = path.join(d, d + '/files/luxun_book.txt')
# Read the whole text. â€˜rbâ€™æ–‡ä»¶ä»¥äºŒè¿›åˆ¶çš„æ–¹å¼è¯»å…¥
text = open(txt_book, 'rb').read()
    
```
ç„¶åæˆ‘ä»¬ç”¨ä½¿ç”¨ä¸€ä¸ªå‡½æ•°å°†å¯¹æ–‡ä»¶æå–å‡ºè¯é¢‘é«˜çš„è¯ï¼Œç”¨åˆ°çš„åº“ jieba.analyse

```
	# å‰50ä¸ªé«˜é¢‘è¯æ±‡
	def jieba_processing_txt(text):
	    result = jieba.analyse.textrank(text, topK=50, withWeight=True)
	    keywords = dict()
	    for i in result:
	        keywords[i[0]] = i[1]
	    return keywords
	
```    

ç„¶åæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡wrodcloudç­‰åº“æ¥ç”Ÿæˆè¯äº‘äº†

	wc = WordCloud(font_path=font_path, background_color="white", max_words=2000, mask=back_coloring,
	               max_font_size=100, random_state=42, width=1000, height=860, margin=2,)
	
	wc.generate_from_frequencies(jieba_processing_txt(text))

é¦–å…ˆå…ˆè‡ªå·±æ‰¾ä¸€å¼ å›¾ç‰‡æ¥ä½œä¸ºç”Ÿæˆè¯äº‘çš„å½¢çŠ¶çš„å›¾

[](http://thomaslzb.github.io/files/luxun_color.img)


    from PIL import Image,ImageSequence
    import numpy as np
    import matplotlib.pyplot as plt
    from wordcloud import WordCloud,ImageColorGenerator
    image= Image.open('./tim.jpg')
    graph = np.array(image)
    wc = WordCloud(font_path='./fonts/simhei.ttf',background_color='White',max_words=50,mask=graph)
    wc.generate_from_frequencies(keywords)
    image_color = ImageColorGenerator(graph)
    plt.imshow(wc)
    plt.imshow(wc.recolor(color_func=image_color))
    plt.axis("off")
    plt.show()
    


ä¿å­˜ç”Ÿæˆå›¾ç‰‡



å®Œæ•´ä»£ç ï¼š

```	
	#-*-coding:utf-8-*-
	
	import jieba
	import jieba.analyse
	# jieba.enable_parallel(4)
	# å¼€å¯å¹¶è¡Œåˆ†è¯æ¨¡å¼ï¼Œå‚æ•°ä¸ºå¹¶è¡Œè¿›ç¨‹æ•°:4 ,but unable to run on Windows
	
	from os import path
	from scipy.misc import imread
	import matplotlib.pyplot as plt
	import os
	from wordcloud import WordCloud, ImageColorGenerator
	
	
	# The function for processing text with Jieba
	# å‰50ä¸ªé«˜é¢‘è¯æ±‡
	def jieba_processing_txt(text):
	    result = jieba.analyse.textrank(text, topK=50, withWeight=True)
	    keywords = dict()
	    for i in result:
	        keywords[i[0]] = i[1]
	    return keywords
	
	# get data directory (using getcwd() is needed to support running example in generated IPython notebook)
	d = path.dirname(__file__) if "__file__" in locals() else os.getcwd()
	
	stopwords_path = d + '/files/stopwords.txt'
	
	# Chinese fonts must be set è¿™ä¸ªå­—åº“å¿…é¡»è¦
	font_path = d + '/files/fonts/SourceHanSerifK-Light.otf'
	
	# the path to save worldcloud
	imgname1 = d + '/files/LuXun.jpg'
	imgname2 = d + '/files/LuXun_colored.jpg'
	
	#files is exist?
	if not (os.path.isfile(stopwords_path) and os.path.isfile(font_path) and \
	        os.path.isfile(imgname1) ) :
	    if not os.path.isfile(stopwords_path):
	        print ("stopwords_path or pngFile does not found!")
	    if not os.path.isfile(font_path):
	        print ("font_path or pngFile does not found!")
	    if not os.path.isfile(imgname1):
	        print ("imgname1 or pngFile does not found!")
	    os._exit(0)
	
	# read the mask / color image taken from
	back_coloring = imread(path.join(d, d + '/files/luxun_color.jpg'))
	txt_book = path.join(d, d + '/files/luxun_book.txt')
	# Read the whole text. â€˜rbâ€™æ–‡ä»¶ä»¥äºŒè¿›åˆ¶çš„æ–¹å¼è¯»å…¥
	text = open(txt_book, 'rb').read()
	
	wc = WordCloud(font_path=font_path, background_color="white", max_words=2000, mask=back_coloring,
	               max_font_size=100, random_state=42, width=1000, height=860, margin=2,)
	
	wc.generate_from_frequencies(jieba_processing_txt(text))
	
	# create coloring from image
	image_colors_default = ImageColorGenerator(back_coloring)
	
	# save wordcloud
	wc.to_file(path.join(d, imgname2))
	
	# recolor wordcloud and show
	plt.figure()
	plt.imshow(wc, interpolation="bilinear")
	plt.axis("off")
	
	
	plt.figure()
	plt.imshow(back_coloring, interpolation="bilinear")
	plt.axis("off")
	
	# show
	# we could also give color_func=image_colors directly in the constructor
	# create coloring from image
	image_colors_byImg = ImageColorGenerator(back_coloring)
	plt.figure()
	plt.imshow(wc.recolor(color_func=image_colors_byImg), interpolation="bilinear")
	plt.axis("off")
	
	plt.show()

```

*  ä»¥ä¸Šä»£ç åœ¨ Python3.6 ä¸‹è¿è¡ŒæˆåŠŸ

    
END




https://www.jb51.net/article/116020.htm